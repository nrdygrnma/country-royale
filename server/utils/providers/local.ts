import { type DataProvider, type FetchResult } from "./index";

export const localProvider: DataProvider = {
  key: "local",
  async fetch(countries, sourceKey): Promise<FetchResult[]> {
    if (sourceKey === "crime_index") {
      const storedCrimeIndex = (await useStorage().getItem(
        "db:crimeIndex",
      )) as Record<string, number> | null;

      return countries.map((code) => {
        // Try stored data first, then fallback to hardcoded data
        const value =
          storedCrimeIndex?.[code] ?? DEFAULT_CRIME_INDEX[code] ?? 0;
        return { countryCode: code, rawValue: value, year: 2025 };
      });
    }

    return countries.map((code) => ({
      countryCode: code,
      rawValue: 0,
    }));
  },
};

// Hardcoded fallback data provided by the user
const DEFAULT_CRIME_INDEX: Record<string, number> = {
  AF: 1.5,
  AL: 5.17,
  DZ: 4.25,
  AD: 8,
  AO: 4.21,
  AG: 4.67,
  AR: 5.67,
  AM: 5.63,
  AU: 7.54,
  AT: 7.54,
  AZ: 3.96,
  BS: 5.58,
  BH: 5.33,
  BD: 4.08,
  BB: 6.13,
  BY: 3.08,
  BE: 7.17,
  BZ: 3.58,
  BJ: 3.75,
  BT: 4.67,
  BO: 4.63,
  BA: 3.88,
  BW: 5.38,
  BR: 5.04,
  BN: 4.63,
  BG: 5.33,
  BF: 2.88,
  BI: 2.33,
  CV: 6.54,
  KH: 3.46,
  CM: 3.13,
  CA: 7.38,
  CF: 2.08,
  TD: 2.33,
  CL: 6.17,
  CN: 5.54,
  CO: 5.46,
  KM: 2.63,
  CD: 2.21,
  CG: 3.08,
  CR: 5.63,
  CI: 5.13,
  HR: 5.92,
  CU: 4.96,
  CY: 4.5,
  CZ: 6.5,
  DK: 8.21,
  DJ: 4.08,
  DM: 5.29,
  DO: 4.92,
  EC: 4.46,
  EG: 3.75,
  SV: 3.25,
  GQ: 2.08,
  ER: 2.21,
  EE: 8.04,
  SZ: 3.21,
  ET: 4.5,
  FJ: 5.38,
  FI: 8.42,
  FR: 7.04,
  GA: 3.5,
  GM: 5.13,
  GE: 5,
  DE: 7.42,
  GH: 5.33,
  GR: 5.13,
  GD: 5.17,
  GT: 4,
  GN: 2.96,
  GW: 2.67,
  GY: 4.25,
  HT: 2.21,
  HN: 3.92,
  HU: 4.79,
  IS: 8.17,
  IN: 5.46,
  ID: 4.29,
  IR: 3.08,
  IQ: 3.33,
  IE: 7.42,
  IL: 5.54,
  IT: 6.38,
  JM: 5.33,
  JP: 7.5,
  JO: 5.63,
  KZ: 4.67,
  KE: 5.17,
  KI: 4.46,
  KP: 1.63,
  KR: 8,
  KW: 5.42,
  KG: 3.79,
  LA: 3.38,
  LV: 7.63,
  LB: 3.08,
  LS: 3.92,
  LR: 3.38,
  LY: 1.88,
  LI: 8.42,
  LT: 7.38,
  LU: 7.5,
  MG: 3.25,
  MW: 4.42,
  MY: 5.71,
  MV: 3.96,
  ML: 2.08,
  MT: 5.08,
  MH: 5.67,
  MR: 3.25,
  MU: 5.58,
  MX: 4.5,
  FM: 5.54,
  MD: 4.08,
  MC: 5.83,
  MN: 5.29,
  ME: 4.83,
  MA: 4.67,
  MZ: 3.25,
  MM: 1.46,
  NA: 4.58,
  NR: 4.83,
  NP: 3.88,
  NL: 7.42,
  NZ: 7.88,
  NI: 2,
  NE: 2.96,
  NG: 5.46,
  MK: 5.29,
  NO: 7.92,
  OM: 5.33,
  PK: 3.96,
  PW: 5.08,
  PA: 4.71,
  PG: 3.21,
  PY: 3.29,
  PE: 4.46,
  PH: 4.46,
  PL: 6.08,
  PT: 6.58,
  QA: 5.46,
  RO: 5.88,
  RU: 3.42,
  RW: 5,
  WS: 5.88,
  SM: 5.29,
  ST: 4.79,
  SA: 3.79,
  SN: 5.88,
  RS: 4.92,
  SC: 5.38,
  SL: 4.04,
  SG: 7.79,
  SK: 4.88,
  SI: 6.21,
  SB: 4.71,
  SO: 1.88,
  ZA: 5.67,
  SS: 2.04,
  ES: 6.67,
  LK: 3.71,
  KN: 5.38,
  LC: 5.54,
  VC: 5.42,
  SD: 2.25,
  SR: 3.17,
  SE: 7.38,
  CH: 7.25,
  SY: 2,
  TJ: 2.54,
  TZ: 4.17,
  TH: 4.96,
  TL: 3.88,
  TG: 4.42,
  TO: 5.17,
  TT: 5.08,
  TN: 4.33,
  TR: 3.96,
  TM: 2.17,
  TV: 5.92,
  UG: 3.67,
  UA: 4.54,
  AE: 5.13,
  GB: 7.63,
  US: 6.96,
  UY: 7.46,
  UZ: 3.83,
  VU: 4.88,
  VE: 1.88,
  VN: 4.79,
  YE: 1.92,
  ZM: 4.67,
  ZW: 3.04,
};
