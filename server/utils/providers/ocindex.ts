import { type DataProvider, type FetchResult } from "./index";

export const ocindexProvider: DataProvider = {
  key: "ocindex",
  async fetch(countries, sourceKey): Promise<FetchResult[]> {
    // Check if we have manually updated crime index data in storage
    let storedCrimeIndex: Record<string, number> | null = null;
    if (sourceKey === "crime_index") {
      storedCrimeIndex = (await useStorage().getItem(
        "db:crimeIndex",
      )) as Record<string, number> | null;
    }

    return countries.map((code) => {
      let value = 0;
      if (sourceKey === "crime_index") {
        value =
          storedCrimeIndex?.[code] ||
          crimeIndexMap[code] ||
          generateConsistentValue(code, 2, 7);
      }
      return { countryCode: code, rawValue: value, year: 2025 };
    });
  },
};

function generateConsistentValue(
  code: string,
  min: number,
  max: number,
): number {
  const hash = code
    .split("")
    .reduce((acc, char) => acc + char.charCodeAt(0), 0);
  return min + (hash % (max - min));
}

// Global Organized Crime Index - Crime Index (0-10)
// These are rough estimations for the demo based on general trends
const crimeIndexMap: Record<string, number> = {
  AF: 8.5,
  AL: 4.83,
  DZ: 5.75,
  AD: 2.0,
  AO: 5.79,
  AG: 5.33,
  AR: 4.33,
  AM: 4.37,
  AU: 2.46,
  AT: 2.46,
  AZ: 6.04,
  BS: 4.42,
  BH: 4.67,
  BD: 5.92,
  BB: 3.87,
  BY: 6.92,
  BE: 2.83,
  BZ: 6.42,
  BJ: 6.25,
  BT: 5.33,
  BO: 5.37,
  BA: 6.12,
  BW: 4.62,
  BR: 4.96,
  BN: 5.37,
  BG: 4.67,
  BF: 7.12,
  BI: 7.67,
  CV: 3.46,
  KH: 6.54,
  CM: 6.87,
  CA: 2.62,
  CF: 7.92,
  TD: 7.67,
  CL: 3.83,
  CN: 4.46,
  CO: 4.54,
  KM: 7.37,
  CD: 7.79,
  CG: 6.92,
  CR: 4.37,
  CI: 4.87,
  HR: 4.08,
  CU: 5.04,
  CY: 5.5,
  CZ: 3.5,
  DK: 1.79,
  DJ: 5.92,
  DM: 4.71,
  DO: 5.08,
  EC: 5.54,
  EG: 6.25,
  SV: 6.75,
  GQ: 7.92,
  ER: 7.79,
  EE: 1.96,
  SZ: 6.79,
  ET: 5.5,
  FJ: 4.62,
  FI: 1.58,
  FR: 2.96,
  GA: 6.5,
  GM: 4.87,
  GE: 5.0,
  DE: 2.58,
  GH: 4.67,
  GR: 4.87,
  GD: 4.83,
  GT: 6.0,
  GN: 7.04,
  GW: 7.33,
  GY: 5.75,
  HT: 7.79,
  HN: 6.08,
  HU: 5.21,
  IS: 1.83,
  IN: 4.54,
  ID: 5.71,
  IR: 6.92,
  IQ: 6.67,
  IE: 2.58,
  IL: 4.46,
  IT: 3.62,
  JM: 4.67,
  JP: 2.5,
  JO: 4.37,
  KZ: 5.33,
  KE: 4.83,
  KI: 5.54,
  KP: 8.37,
  KR: 2.0,
  KW: 4.58,
  KG: 6.21,
  LA: 6.62,
  LV: 2.37,
  LB: 6.92,
  LS: 6.08,
  LR: 6.62,
  LY: 8.12,
  LI: 1.58,
  LT: 2.62,
  LU: 2.5,
  MG: 6.75,
  MW: 5.58,
  MY: 4.29,
  MV: 6.04,
  ML: 7.92,
  MT: 4.92,
  MH: 4.33,
  MR: 6.75,
  MU: 4.42,
  MX: 5.5,
  FM: 4.46,
  MD: 5.92,
  MC: 4.17,
  MN: 4.71,
  ME: 5.17,
  MA: 5.33,
  MZ: 6.75,
  MM: 8.54,
  NA: 5.42,
  NR: 5.17,
  NP: 6.12,
  NL: 2.58,
  NZ: 2.12,
  NI: 8.0,
  NE: 7.04,
  NG: 4.54,
  MK: 4.71,
  NO: 2.08,
  OM: 4.67,
  PK: 6.04,
  PW: 4.92,
  PA: 5.29,
  PG: 6.79,
  PY: 6.71,
  PE: 5.54,
  PH: 5.54,
  PL: 3.92,
  PT: 3.42,
  QA: 4.54,
  RO: 4.12,
  RU: 6.58,
  RW: 5.0,
  WS: 4.12,
  SM: 4.71,
  ST: 5.21,
  SA: 6.21,
  SN: 4.12,
  RS: 5.08,
  SC: 4.62,
  SL: 5.96,
  SG: 2.21,
  SK: 5.12,
  SI: 3.79,
  SB: 5.29,
  SO: 8.12,
  ZA: 4.33,
  SS: 7.96,
  ES: 3.33,
  LK: 6.29,
  KN: 4.62,
  LC: 4.46,
  VC: 4.58,
  SD: 7.75,
  SR: 6.83,
  SE: 2.62,
  CH: 2.75,
  SY: 8.0,
  TJ: 7.46,
  TZ: 5.83,
  TH: 5.04,
  TL: 6.12,
  TG: 5.58,
  TO: 4.83,
  TT: 4.92,
  TN: 5.67,
  TR: 6.04,
  TM: 7.83,
  TV: 4.08,
  UG: 6.33,
  UA: 5.46,
  AE: 4.87,
  GB: 2.37,
  US: 3.04,
  UY: 2.54,
  UZ: 6.17,
  VU: 5.12,
  VE: 8.12,
  VN: 5.21,
  YE: 8.08,
  ZM: 5.33,
  ZW: 6.96,
};
